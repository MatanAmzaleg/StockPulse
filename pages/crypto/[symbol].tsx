import Head from 'next/head';
import Header from '@/components/Header';
import Sidebar from '@/components/Sidebar';
import { useEffect, useState } from 'react';
import { useRouter } from 'next/router';
import useWebSockets from '@/hooks/useWebSockets';
import { Currencies } from '@/typings';

export default function CryptoSymbol() {
    const router = useRouter();
    const [symbol, setSymbol] = useState<string>('');
    const [currencies, setCurrencies] = useState<Currencies | null>(null);

    const getCurrencies = async (symbol: string) => {
        // try to fix it
        const { currencies } = await useWebSockets([symbol]);
        return currencies;
    };

    useEffect(() => {
        if (router.query?.symbol) {
            console.log('found a symbol');
            const symbol = router.query.symbol as string;
            getCurrencies(symbol).then((currencies) =>
                setCurrencies(currencies)
            );
        }
    }, []);

    return (
        <>
            <Head>
                <title>Stock Pulse</title>
                <meta
                    name="description"
                    content="Generated by create next app"
                />
                <meta
                    name="viewport"
                    content="width=device-width, initial-scale=1"
                />
                <link rel="icon" href="/favicon.ico" />
            </Head>
            <main className="home-container">
                <Header />
                <Sidebar />
                {!currencies ? (
                    <div className="found">{JSON.stringify(currencies)}</div>
                ) : (
                    <div className="">loading</div>
                )}
            </main>
        </>
    );
}
