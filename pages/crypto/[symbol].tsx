import Head from 'next/head';
import Header from '@/components/Header';
import Sidebar from '@/components/Sidebar';
import CryptoDetails from '@/components/CryptoDetails';
import axios from 'axios';
import { formmatedDate } from '@/utils/format';
import { getCurrencyDataURL } from '@/utils/requests';

export default function CryptoSymbol({ data }: any) {
    return (
        <>
            <Head>
                <title>Stock Pulse</title>
                <meta
                    name="description"
                    content="Generated by create next app"
                />
                <meta
                    name="viewport"
                    content="width=device-width, initial-scale=1"
                />
                <link rel="icon" href="/favicon.ico" />
            </Head>
            <main className="home-container">
                <Header />
                <Sidebar />
                <CryptoDetails currencyData={data} />
            </main>
        </>
    );
}

export const getServerSideProps = async ({ params }: { params: any }) => {
    try {
        const todayFormat = formmatedDate(new Date());
        const yesterdayFormat = formmatedDate(new Date(Date.now() - 864e5));

        const response = await axios.get(
            getCurrencyDataURL(params.symbol, todayFormat, yesterdayFormat)
        );

        return {
            props: {
                data: response.data.results[0],
            },
        };
    } catch (err) {
        console.log('failed to fetch crypto details', err);
    }
};
